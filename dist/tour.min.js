class Spotlight{constructor(t=0){this.padding=t,this.spotlight=[],this.create()}create(){for(let t=0;t<4;t++){let t=document.createElement("div");t.classList.add("tour-overlay"),document.body.appendChild(t),this.spotlight.push(t)}}move(t){const i=t.getBoundingClientRect();this.spotlight[0].style.top=i.top-this.padding-this.spotlight[0].getBoundingClientRect().height+"px",this.spotlight[1].style.left=i.right+this.padding+"px",this.spotlight[1].style.top=i.top-this.padding+"px",this.spotlight[2].style.top=i.bottom+this.padding+"px",this.spotlight[3].style.left=i.left-this.padding-this.spotlight[3].getBoundingClientRect().width+"px",this.spotlight[3].style.top=i.top-this.padding+"px",this.spotlight[3].style.height=i.height+2*this.padding+"px",this.spotlight[1].style.height=i.height+2*this.padding+"px"}blackout(){this.spotlight[0].style.top="0px",this.spotlight[1].style.left=this.spotlight[1].getBoundingClientRect().width+"px",this.spotlight[2].style.top=this.spotlight[2].getBoundingClientRect().height+"px",this.spotlight[3].style.left="-"+this.spotlight[3].getBoundingClientRect().width+"px"}kill(){return 0!=this.spotlight.length&&this.spotlight.forEach(t=>{t.remove()}),null}}class Tour{constructor(t,e,s=0){this.varName=t,this.steps=e,this.step=s,this.currentState=0,this.currentElement=null,this.popupElement=null,this.spotlight=null,this.textVariables={},this.options={},this.setOptions(),this.createResizeObserver()}static getSavedTour(t){let e=sessionStorage.getItem("tour");e=JSON.parse(e);let s=new Tour(t,e.steps,parseInt(e.step));return s.spotlight=e.spotlight,s.setTextVariables(e.textVariables),s.setOptions(e.options),s}setTextVariables(t){this.textVariables=t}setOptions({disableScroll:t=!0,spotlight:e=!0,language:s="en",scrollMargin:i=50}={}){this.options.disableScroll=t,this.options.spotlight=e,this.options.language=s,this.options.scrollMargin=i}save(){let t={currentState:this.currentState.toString(),steps:this.steps,step:this.step.toString(),styles:this.styles,options:this.options,textVariables:this.textVariables};sessionStorage.setItem("Tour.js",JSON.stringify(t))}start(){1!=this.currentState?(this.currentState=1,this.setWindowResizeEvent(!0),this.createPopup(),this.options.spotlight&&(this.spotlight=new Spotlight(10)),this.makeStep()):console.warn("The Tour has already started.")}previous(){this.step--,this.currentElement&&this.toggleResizeObserver(!1),this.makeStep()}next(){this.step++,this.currentElement&&this.toggleResizeObserver(!1),this.step<this.steps.length?this.makeStep():this.endTour()}makeStep(){const t=this.steps[this.step].id;let e;this.updatePopup(),t?(this.currentElement=document.getElementById(t),this.toggleResizeObserver(!0),e=this.getPopupPos()):(this.currentElement=null,e=this.getCenterPos());let s={beforeMove:this.popupElement.getBoundingClientRect()};this.movePopup(e),s.afterMove=this.popupElement.getBoundingClientRect(),this.options.spotlight&&(this.currentElement?this.spotlight.move(this.currentElement):this.spotlight.blackout()),console.log(s),this.options.disableScroll&&this.toggleScroll(!1),t&&(this.currentElement.scrollMarginTop="0px")}endTour(){this.currentState=2,this.popupElement.remove(),this.setWindowResizeEvent(!1),this.options.spotlight&&this.spotlight.kill(),this.toggleScroll(!0)}isLastStep(){return this.step==this.steps.length-1}getPopupPos(){this.currentElement.style.scrollMarginTop=this.options.scrollMargin+"px";const t=this.getTopOrBottom(this.currentElement);this.currentElement.scrollIntoView(t);const e=document.body.getBoundingClientRect(),s=this.currentElement.getBoundingClientRect(),i=this.popupElement.getBoundingClientRect();let o={x:0,y:0};return e.width-s.width<=e.width/2?s.bottom<window.innerHeight/2?(o.x=s.left+s.width/2-i.width/2,o.y=s.bottom+10):(o.x=s.left+s.width/2-i.width/2,o.y=s.top-10-i.height):s.right<e.width/2?(o.x=s.right+10,o.y=s.top+s.height/2-i.height/2,e.width-i.width<s.right&&(this.currentElement.scrollIntoView(!0),o.x=s.left+s.width/2-i.width/2,o.y=s.bottom+10)):(o.x=s.left-10-i.width<0?0:s.left-10-i.width,o.y=s.top+s.height/2-i.height/2,i.width>s.left&&(this.currentElement.scrollIntoView(!0),o.x=s.left+s.width/2-i.width/2,o.y=s.bottom+10)),o.x=Math.abs(o.x),o.y=Math.abs(o.y),o}getCenterPos(){const t=this.popupElement.getBoundingClientRect(),e={x:0,y:0};return e.x=window.innerWidth/2-t.width/2,e.y=window.innerHeight/2-t.height/2,e}getTopOrBottom(t){const e=document.body.offsetHeight;return t.offsetTop<e/2}createPopup(){const t=document.createElement("div");t.classList.add("tour-popup-container"),document.body.append(t),this.popupElement=t}updatePopup(){const t=this.popupElement,e=this.steps[this.step];let s=e.text;for(let t in this.textVariables)s=s.replace("PLACEHOLDER-"+t,this.textVariables[t]);let i="Previous",o="Next",n="End tour";if(this.options.language){switch(this.options.language){case"fr":i="Retour",o="Suivant",n="Terminer le tour"}}let r="";e.img&&""!=e.img&&(r+=`<img src="${e.img}"/>`),r+=`\n            <p>${s}</p>\n            <div class="tour-button-container"> `,0!=this.step&&(r+=`\n                <button class="tour-button tour-button--previous" onclick="${this.varName}.previous()">\n                    ${i}\n                </button>`),r+=`<button class="tour-button tour-button--next" onclick="${this.varName}.next()">\n                    ${this.isLastStep()?n:o}\n                </button>\n            </div>\n        `,t.innerHTML=r,this.popupElement=t}movePopup(t){this.popupElement.style.left=t.x+"px",this.popupElement.style.top=t.y+"px"}toggleScroll(t){const e=window.pagexOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;window.onscroll=t?()=>{}:()=>{window.scrollTo(e,s)}}setWindowResizeEvent(t){if(t){let t;window.onresize=(()=>{clearTimeout(t),t=setTimeout(()=>{this.makeStep()},100)})}else window.onresize=(()=>{})}createResizeObserver(){let t;this.resizeObserver=new ResizeObserver(e=>{clearTimeout(t),t=setTimeout(()=>{this.makeStep(e[0])},20)})}toggleResizeObserver(t){t?this.resizeObserver.observe(this.currentElement):this.resizeObserver.unobserve(this.currentElement)}}